window.addEventListener('message', function (event) {
  if (event.data.type === 'form-ready') {
    console.log('form-ready event has been triggered correctly')
  }

  if (event.data.type === 'form-submit') {
    console.log('form-submit event has been triggered correctly')
  }

  if (event.data.type === 'form-closed') {
    console.log('form-closed event has been triggered correctly')
  }

  if (event.data.type === 'embed-auto-close-popup') {
    console.log('embed-auto-close-popup event has been triggered correctly')
  }
})

var queryString = window.location.search

var EMBED_DOM_CLASSES = [
  {
    selector: '.typeform-widget',
    attribute: 'data-url',
  }, {
    selector: '.typeform-share',
    attribute: 'href',
  }, {
    selector: '.typeform-full',
    attribute: 'src',
  },
]

window.addEventListener('DOMContentLoaded', function () {
  if (queryString.length === 0) {
    return
  }

  EMBED_DOM_CLASSES
    .forEach(function (embed) {
      var attribute = embed.attribute
      var embeds = document.querySelectorAll(embed.selector)
      embeds.forEach(function (embed) {
        var embedAttr = embed.getAttribute(attribute)
        embed.setAttribute(attribute, embedAttr + queryString)
      })
    })
})
